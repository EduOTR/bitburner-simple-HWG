/**
 * @param {import("../").NS} ns 
 */
export async function main(ns) {

    var target = {
        name: ns.args[0],
        moneyThreshold: ns.args[1],
        securityThreshold: ns.args[2],
    };
    var host = {
        name: ns.args[3],
        totalRam: ns.args[4],
    };
    var scriptName;


    while(true) {
        
        if (ns.getServerSecurityLevel(target.name) > target.securityThreshold) {
            scriptName = "weaken.js";
        }
        else if (ns.getServerMoneyAvailable(target.name) < target.moneyThreshold) {
            scriptName = "grow.js";
        }
        else {
            scriptName = "hack.js";
        }

        var usedRam = ns.getServerUsedRam(host.name);
        var freeRam = host.totalRam - usedRam;
        var scriptRam = ns.getScriptRam(scriptName);
        var numThreads = Math.floor(freeRam / scriptRam);

        if (!numThreads) {
            throw "Insufficient RAM";
        }
        else if (numThreads > 2048) {
            numThreads = 2048;
            var processID = ns.run(scriptName, numThreads, target.name);
        }
        else {
            var processID = ns.run(scriptName, numThreads, target.name);
        }
        
        while (ns.isRunning(processID)) {
            await ns.sleep(100);
        }
    }
}